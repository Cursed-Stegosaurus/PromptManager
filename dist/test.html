<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Library Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-input {
            width: 100%;
            min-height: 100px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: monospace;
        }
        .test-button {
            background: #0075BA;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a8b;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            background: #f0f0f0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Prompt Library Extension Test Page</h1>
    
    <div class="test-section">
        <h2>Extension Status</h2>
        <div id="extension-status" class="status info">Checking extension status...</div>
        <button class="test-button" onclick="checkExtension()">Check Extension</button>
        <button class="test-button" onclick="openSidePanel()">Open Side Panel</button>
    </div>

    <div class="test-section">
        <h2>Text Insertion Test</h2>
        <p>Click in the text area below and then click "Insert Test Text" to test the extension's text insertion functionality.</p>
        <textarea id="test-textarea" class="test-input" placeholder="Click here and then test text insertion..."></textarea>
        <br>
        <button class="test-button" onclick="insertTestText()">Insert Test Text</button>
        <button class="test-button" onclick="clearText()">Clear Text</button>
    </div>

    <div class="test-section">
        <h2>Context Menu Test</h2>
        <p>Right-click in the text area below to test the context menu integration.</p>
        <textarea id="context-test" class="test-input" placeholder="Right-click here to test context menu..."></textarea>
    </div>

    <div class="test-section">
        <h2>Console Log</h2>
        <div id="console-log" class="status info">Console messages will appear here...</div>
        <button class="test-button" onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        // Test extension functionality
        function checkExtension() {
            const statusDiv = document.getElementById('extension-status');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({ type: 'ping' }, (response) => {
                    if (chrome.runtime.lastError) {
                        statusDiv.className = 'status error';
                        statusDiv.textContent = 'Extension not responding: ' + chrome.runtime.lastError.message;
                        log('Extension error: ' + chrome.runtime.lastError.message);
                    } else if (response && response.status === 'ok') {
                        statusDiv.className = 'status success';
                        statusDiv.textContent = 'Extension is working correctly!';
                        log('Extension is working correctly');
                    } else {
                        statusDiv.className = 'status error';
                        statusDiv.textContent = 'Extension responded but with unexpected data';
                        log('Extension responded with unexpected data: ' + JSON.stringify(response));
                    }
                });
            } else {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'Chrome extension APIs not available';
                log('Chrome extension APIs not available');
            }
        }

        function openSidePanel() {
            if (chrome.sidePanel) {
                chrome.sidePanel.open().then(() => {
                    log('Side panel opened successfully');
                }).catch((error) => {
                    log('Failed to open side panel: ' + error.message);
                });
            } else {
                log('Side panel API not available');
            }
        }

        function insertTestText() {
            const textarea = document.getElementById('test-textarea');
            const testText = `This is a test prompt for the Prompt Library extension.

Features to test:
- Text insertion
- Context menu integration
- Side panel functionality

Timestamp: ${new Date().toLocaleString()}`;

            if (chrome.runtime) {
                chrome.runtime.sendMessage({ 
                    type: 'insert', 
                    text: testText 
                }, (response) => {
                    if (response && response.success) {
                        log('Text inserted successfully via extension');
                    } else {
                        log('Extension insert failed, using fallback');
                        insertTextFallback(textarea, testText);
                    }
                });
            } else {
                insertTextFallback(textarea, testText);
            }
        }

        function insertTextFallback(textarea, text) {
            const start = textarea.selectionStart || 0;
            const end = textarea.selectionEnd || 0;
            textarea.value = textarea.value.substring(0, start) + text + textarea.value.substring(end);
            textarea.selectionStart = textarea.selectionEnd = start + text.length;
            textarea.focus();
            log('Text inserted using fallback method');
        }

        function clearText() {
            document.getElementById('test-textarea').value = '';
            log('Text cleared');
        }

        function clearLog() {
            document.getElementById('console-log').textContent = 'Console messages will appear here...';
        }

        function log(message) {
            const logDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            console.log(`[${timestamp}] ${message}`);
        }

        // Auto-check extension on page load
        window.addEventListener('load', () => {
            setTimeout(checkExtension, 1000);
        });

        // Listen for messages from the extension
        if (chrome.runtime) {
            chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
                log('Message received from extension: ' + JSON.stringify(message));
                sendResponse({ received: true });
            });
        }
    </script>
</body>
</html>
